{% extends request.htmx|yesno:"base_htmx.html,base.html" %}

{% load field_tags components crispy_forms_tags string_utils %}

{% block page_title %}{{ customer.name }}{% endblock %}

{% block content %}
    {% component "cerberus/components/dropdown.html" %}
        <ul role="listbox">
            <li><a href="{% url 'customer_update' customer.id %}">Edit</a></li>
            <li><a hx-get="{% url 'customer_delete' customer.id %}" hx-target="main" hx-swap="afterend" href="{% url 'customer_delete' customer.id %}">Delete</a></li>
        </ul>
    {% endcomponent %}
    <div class="row">
        <div class="details col" role="main">
            <div class="name">{{ customer.name }}</div>
            <div class="email">{{ customer.invoice_email|mailto }}</div>
            {{ customer.invoice_address|linebreaks }}
        </div>
        {% if customer.invoiced_unpaid %}
            <div class="customer finance">
                <table>
                    <tr>
                        <th colspan="2">Outstanding:</th>
                        <th>{{ customer.invoiced_unpaid }}</th>
                    </tr>
                    {% for invoice in customer.outstanding_invoices %}
                        <tr class="invoice">
                            <td><a href="{% url 'invoice_detail' invoice.id %}">{{ invoice.name }}</a></td>
                            <td class="{{ invoice.overdue|yesno:'overdue,due' }}">{{ invoice.due }}</td>
                            <td>{{ invoice.total }}</td>
                        </tr>
                    {% endfor %}
                </table>
            </div>
        {% endif %}
    </div>
    {% component "cerberus/components/tab-wrapper.html" inital="bookings" %}
        <nav class="tab-nav">
            <a href="#bookings" :class="navClass('bookings')" @click.prevent="setActive('bookings')">Bookings</a>
            <a href="#charges" :class="navClass('charges')" @click.prevent="setActive('charges')">Charges</a>
            <a href="#invoices" :class="navClass('invoices')" @click.prevent="setActive('invoices')">Invoices</a>
            <a href="#pets" :class="navClass('pets')" @click.prevent="setActive('pets')">Pets</a>
            <a href="#contacts" :class="navClass('contacts')" @click.prevent="setActive('contacts')">Contacts</a>
        </nav>
        <div class="tabs">
            <section id="bookings" class="tab-content" x-show="active == 'bookings'">
                {% include "cerberus/customer_tabs/bookings.html" %}
            </section>
            <section id="charges" class="tab-content" x-show="active == 'charges'">
                {% include "cerberus/customer_tabs/charges.html" %}
            </section>
            <section id="invoices" class="tab-content" x-show="active == 'invoices'">
                {% include "cerberus/customer_tabs/invoices.html" %}
            </section>
            <section id="pets" class="tab-content" x-show="active == 'pets'">
                {% include "cerberus/customer_tabs/pets.html" %}
            </section>
            <section id="contacts" class="tab-content" x-show="active == 'contacts'">
                {% include "cerberus/customer_tabs/contacts.html" %}
            </section>
        </div>
    {% endcomponent %}

    <a class="fab" href="{% url 'invoice_create' %}?customer={{ object.pk }}" title="Add an invoice">{% include 'icons/plus.svg' %}</a>
{% endblock %}
