# Generated by Django 4.0.5 on 2022-08-02 07:53

import re
from django.db import migrations
from icecream import ic

def assign_invoice_emails(apps, schema_editor):
    email_regex = re.compile(r"[^@]+@[^@]+\.[^@]+")
    
    for customer in apps.get_model("crm", "Customer").objects.all():
        for contact in customer.contacts.all():
            if email_regex.match(contact.details):
                customer.invoice_email = contact.details
                customer.save()
                break


class Migration(migrations.Migration):

    dependencies = [
        ('crm', '0037_customer_invoice_email'),
    ]

    operations = [
        migrations.RunPython(assign_invoice_emails)
    ]
